<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Integrated Step Selection Functions – NWT Muskox Collar Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-327735d1480bff6f7510335fe22ad292.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../quarto/step_selection_functions.html">Integrated Step Selection Functions</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">NWT Muskox Collar Project</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/01_data_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Cleaning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/02_movement_patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/03_home_range.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lifetime Home Range</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/04_annual_range.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Annual Home Range</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/05_seasonal_range.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Range</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/06_seasonal_range_mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home Range Modelling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto/step_selection_functions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Integrated Step Selection Functions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Integrated Step Selection Functions</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this document, we will use integrated step selection analysis (iSSA) to model movement decisions of the Sahtu muskoxen. Models will be fit using the <strong>amt</strong> package. We’ll start by loading the data and required packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### group data by ID and season</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>musk_collar_season <span class="ot">&lt;-</span> musk_collar_filt <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(snowdepth_locs) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, Id_Number) <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">season_delineation</span>(datetime, snow_depth, <span class="fl">0.01</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="co"># season = ifelse(month &gt;= 4 &amp; month &lt;= 7 &amp; season == "winter", "calving", season),</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_min =</span> <span class="fu">minimum_year_season</span>(year,datetime,season))  <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_season =</span> <span class="fu">str_c</span>(Id_Number,<span class="st">"_"</span>,season)) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Id_Number, Latitude, Longitude, datetime)`</code></pre>
</div>
</div>
<p>Next let’s look at some of the relationships between the spatial data we’ll be using in the models. First let’s look at historical fire data and how it relates to forest cover data:</p>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> musk_collar_season) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fire_data_subset <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(musk_collar_season)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_crop</span>(musk_collar_season) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(fireyear<span class="sc">&lt;=</span><span class="dv">2012</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="cn">NA</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> fireyear), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Fires from 1997 - 2012"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>prcC_2020_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/prcC_2020_proj.tif"</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lc_2010_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/lc_2010_proj.tif"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(lc_2010_proj) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> <span class="fu">round</span>(count<span class="sc">/</span>(<span class="fu">ncol</span>(lc_2010_proj)<span class="sc">*</span><span class="fu">nrow</span>(lc_2010_proj)),<span class="dv">3</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> lc_2010_proj) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fire_data_subset <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_crop</span>(lc_2010_proj) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(fireyear<span class="sc">&lt;=</span><span class="dv">2010</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            nngeo<span class="sc">::</span><span class="fu">st_remove_holes</span>(),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">colour =</span> fireyear), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(trans = "sqrt") +</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient</span>(<span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">low =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"SCANFI canopy</span><span class="sc">\n</span><span class="st">cover in 2020"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;SpatRaster&gt; resampled to 501102 cells.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/fire_hist_data-1.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<pre><code>   layer                                             value   count  freq
1      1          Temperate or sub-polar needleleaf forest 6834296 0.295
2      1                 Sub-polar taiga needleleaf forest 9012663 0.389
3      1 Temperate or sub-polar broadleaf deciduous forest    4721 0.000
4      1                                      Mixed forest  259389 0.011
5      1                  Temperate or sub-polar shrubland 1780507 0.077
6      1                  Temperate or sub-polar grassland 1118608 0.048
7      1          Sub-polar or polar shrubland-lichen-moss   26117 0.001
8      1          Sub-polar or polar grassland-lichen-moss   67969 0.003
9      1                                           Wetland 1214924 0.052
10     1                                      Barren Lands  281304 0.012
11     1                                Urban and built-up    9547 0.000
12     1                                             Water 2581939 0.111
13     1                                      Snow and Ice      15 0.000</code></pre>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/fire_hist_data-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>The first image shows that muskoxen appear to favour areas impacted by recent fires to some degree. The second image shows that canopy cover is also impacted by recent fires, although the relative recency of the fire doesn’t seem to have a large effect on differences in canopy cover across areas impacted by fires. In any case, it will be important to account for changes in canopy cover that have occurred since the collars stopped recording as these areas likely had higher canopy cover during the monitoring period.</p>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fire_2010 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/fire_year/2010-01-01.tif"</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>nbr_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/ntems_fire_nbr_proj.tif"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>lc_2010_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/lc_2010_proj.tif"</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>fire_2010_resamp <span class="ot">&lt;-</span> <span class="fu">resample</span>(fire_2010, lc_2010_proj, <span class="at">method =</span> <span class="st">"near"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>reclass <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">10</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>             <span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">20</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>             <span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">30</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>             <span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">40</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>             <span class="dv">40</span>,<span class="dv">80</span>,<span class="dv">50</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>reclass_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(reclass, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fire_2010_cat <span class="ot">&lt;-</span> <span class="fu">classify</span>(fire_2010_resamp, reclass_m, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>nbr_proj_resamp <span class="ot">&lt;-</span> <span class="fu">resample</span>(nbr_proj, lc_2010_proj, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>reclass2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">27</span>,<span class="dv">1</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>             <span class="dv">27</span>,<span class="dv">66</span>,<span class="dv">2</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>             <span class="dv">66</span>,<span class="dv">174</span>,<span class="dv">3</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>reclass2_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(reclass2, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>nbr_proj_cat <span class="ot">&lt;-</span> <span class="fu">classify</span>(nbr_proj_resamp, reclass2_m, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>nbr_proj_cat[<span class="fu">is.na</span>(nbr_proj_cat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>fire_sev <span class="ot">&lt;-</span> fire_2010_cat <span class="sc">+</span> nbr_proj_cat</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>fire_sev_sum <span class="ot">&lt;-</span> <span class="fu">crosstab</span>(<span class="fu">c</span>(fire_sev, lc_2010_proj)) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">levels</span>(lc_2010_proj)[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">coltab</span>(lc_2010_proj)[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rgb =</span> <span class="fu">rgb</span>(red, green, blue, <span class="at">maxColorValue =</span> <span class="dv">255</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cover <span class="sc">!=</span> <span class="st">"Sub-polar or polar barren-lichen-moss"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>         cover <span class="sc">!=</span> <span class="st">"Cropland"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(value)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fire_sev_sum <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fire_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"10_1"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"10_1"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"10_2"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">13</span> <span class="sc">~</span> <span class="st">"10_3"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">"20_1"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">21</span> <span class="sc">~</span> <span class="st">"20_1"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">22</span> <span class="sc">~</span> <span class="st">"20_2"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">23</span> <span class="sc">~</span> <span class="st">"20_3"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">&lt;=</span> <span class="dv">31</span> <span class="sc">~</span> <span class="st">"30_1"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">==</span> <span class="dv">32</span> <span class="sc">~</span> <span class="st">"30_2"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">&lt;=</span> <span class="dv">33</span> <span class="sc">~</span> <span class="st">"30_3"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    year_diff <span class="sc">&lt;=</span> <span class="dv">43</span> <span class="sc">~</span> <span class="st">"40"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"40+"</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fire_class, cover) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fire_class) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">cover =</span> <span class="fu">factor</span>(cover, <span class="at">levels =</span> cols<span class="sc">$</span>cover)) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fire_class, <span class="at">y =</span> p, <span class="at">fill =</span> cover)) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols<span class="sc">$</span>rgb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'fire_class'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/fire_landcover-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mrtri3_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/mrtri3_proj.tif"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mrtpi_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/mrtpi_proj.tif"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> mrtri3_proj) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> musk_collar_season, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">trans =</span> <span class="st">"sqrt"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;SpatRaster&gt; resampled to 501102 cells.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> mrtpi_proj) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> musk_collar_season <span class="sc">%&gt;%</span> <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"winter"</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;SpatRaster&gt; resampled to 501102 cells.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># musk_collar_season %&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::leaflet() %&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::addCircles() %&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::addRasterImage(mrtri3_proj %&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                             terra::aggregate(5))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/dem_data-1.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/dem_data-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>There does seem to be avoidance of some areas with high TRI values, however muskox do appear to cross ridge tops to get to potential foraging areas on the other side. Lastly, let’s look at the proximity to water and how it relates to muskox movements.</p>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>water_dist <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/water_dist.tif"</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> <span class="fu">log</span>(water_dist<span class="sc">/</span><span class="dv">1000</span><span class="sc">+</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> musk_collar_season, <span class="at">colour =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;SpatRaster&gt; resampled to 501102 cells.</code></pre>
</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="step_selection_functions_files/figure-html/waterprox-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Doesn’t seem to be a huge correlation between GPS points and proximity to water, but still worth exploring further in some models.</p>
<p>To see if temperature extremes have an effect on movement behaviour in the winter and summer let’s overlay temperature data with collar data. We will plot the days preceding and following the extreme weather day to see if there is a change in movement behaviour.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lc_2010_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/lc_2010_proj.tif"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>temp_ext <span class="ot">=</span> <span class="dv">28</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>rain_ext <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>wind_ext <span class="ot">=</span> <span class="dv">31</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>weather_data_average <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data/processed/weather_data_average.rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_max_temp, <span class="dv">1</span>) <span class="sc">&gt;</span> temp_ext <span class="sc">~</span> <span class="st">"day1"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      avg_max_temp <span class="sc">&gt;</span> temp_ext <span class="sc">~</span> <span class="st">"day0"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lead</span>(avg_max_temp, <span class="dv">1</span>) <span class="sc">&gt;</span> temp_ext <span class="sc">~</span> <span class="st">"day-1"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"mild"</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rain_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      avg_precip <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day0"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">1</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day1"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">2</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day2"</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">3</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day3"</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">4</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day4"</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">5</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day5"</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">6</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day6"</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(avg_precip, <span class="dv">7</span>) <span class="sc">&gt;</span> rain_ext <span class="sc">~</span> <span class="st">"day7"</span>,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"mild"</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_rain_time =</span> <span class="fu">as.Date</span>(<span class="fu">ifelse</span>(avg_precip <span class="sc">&gt;</span> rain_ext, date, <span class="cn">NA</span>)),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_rain_time =</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(last_rain_time, <span class="at">na.rm =</span> <span class="cn">FALSE</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_since_rain =</span> <span class="fu">difftime</span>(date, last_rain_time, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekly_rain =</span> zoo<span class="sc">::</span><span class="fu">rollsum</span>(avg_precip, <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(musk_collar_season<span class="sc">$</span>Id_Number)){</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  summer_temp <span class="ot">&lt;-</span> musk_collar_season <span class="sc">%&gt;%</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">32609</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(month <span class="sc">&gt;=</span><span class="dv">6</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>           month<span class="sc">&lt;=</span><span class="dv">8</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>           Id_Number <span class="sc">==</span> <span class="dv">7012</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(weather_data_average) <span class="sc">%&gt;%</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(avg_mean_temp <span class="sc">&gt;</span> <span class="dv">15</span>)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lines &lt;- summer_temp %&gt;%</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   arrange(datetime) %&gt;%</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   mutate(flag = rain_flag == "day0" &amp; </span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            date != lag(date,1),</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          flag = ifelse(is.na(flag), TRUE, flag),</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          group = cumsum(flag)) %&gt;%</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   group_by(group) %&gt;%</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   summarise(do_union = FALSE) %&gt;%</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   st_cast("LINESTRING")</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(summer_temp)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> summer_temp  <span class="sc">%&gt;%</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>      tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> lc_2010_proj <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">crop</span>(summer_temp)) <span class="sc">+</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_sf(data = lines) +</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">colour =</span> weekly_rain), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_viridis_c</span>()</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> {<span class="cf">next</span>}</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plot)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "706"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7080"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "707"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "709"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "710"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7012"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7011"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7010"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7013"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "708"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/temp_extremes-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There doesn’t appear to be any sign of muskoxen moving differently after days with high temperatures (&gt;28 degrees).Most of the time they seem to hang out where they already are, though there were a few instances where they started moving larger distances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>issa_data <span class="ot">&lt;-</span> musk_collar_season <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">32609</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### remove 709 because it follows the same path as 710</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Id_Number <span class="sc">!=</span> <span class="dv">709</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="do">### convert data into tracks for amt package</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>issa_track <span class="ot">&lt;-</span> <span class="fu">make_track</span>(issa_data, </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                   x, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>                   y, </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>                   datetime, </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id_season =</span> id_season,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> Id_Number,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">season =</span> season,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="do">### nest tracks by ID season</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>issa_track_nest <span class="ot">&lt;-</span> issa_track <span class="sc">%&gt;%</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span><span class="fu">c</span>(id,id_season,season))</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(issa_track_nest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  id_season   id    season data                
  &lt;chr&gt;       &lt;fct&gt; &lt;chr&gt;  &lt;list&gt;              
1 706_winter  706   winter &lt;trck_xyt [956 × 3]&gt;
2 7080_winter 7080  winter &lt;trck_xyt [924 × 3]&gt;
3 707_winter  707   winter &lt;trck_xyt [107 × 3]&gt;
4 710_winter  710   winter &lt;trck_xyt [218 × 3]&gt;
5 706_summer  706   summer &lt;trck_xyt [398 × 3]&gt;
6 7080_summer 7080  summer &lt;trck_xyt [619 × 3]&gt;</code></pre>
</div>
</div>
<section id="issa-models" class="level2">
<h2 class="anchored" data-anchor-id="issa-models">ISSA Models</h2>
<p>Lets prepare the data for use in ISSA. We’ll first resample the data to ensure each step is 8 hours in length. Next we will convert groups of steps into bursts, where a new burst occurs when the time between subsequent steps is greater than 8 hours. Lastly, we will sample random steps for each observed step so that we can compare available and used locations. We use the recommended sample size of 10 for available steps, but will test the robustness of these models by increasing the sample size once we have an appropriate model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create bursts whenever time between steps exceeds 8 hours and</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="do">### transform locations into steps</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>issa_bursts_summer <span class="ot">&lt;-</span> issa_track_nest <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"summer"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_resamp =</span> <span class="fu">map</span>(data, <span class="cf">function</span>(x)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">%&gt;%</span> <span class="fu">track_resample</span>(<span class="at">rate =</span> <span class="fu">hours</span>(<span class="dv">8</span>), <span class="at">tolerance =</span> <span class="fu">hours</span>(<span class="dv">1</span>))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">steps =</span> <span class="fu">map2</span>(data,data_resamp, <span class="cf">function</span>(x,y)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y<span class="sc">$</span>burst_))<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">%&gt;%</span> <span class="fu">steps</span>()</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> y <span class="sc">%&gt;%</span> <span class="fu">steps_by_burst</span>()</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">rand_steps =</span> <span class="fu">map</span>(steps, <span class="cf">function</span>(x){</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">%&gt;%</span> <span class="fu">random_steps</span>(<span class="at">n_control =</span> <span class="dv">10</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 11.1469734290516</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.6548057405404</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.63285409049334</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.62937688498926</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.66647219202187</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 71 warnings in `mutate()`.
The first warning was:
ℹ In argument: `rand_steps = map(...)`.
Caused by warning in `random_steps.bursted_steps_xyt()`:
! Some bursts contain &lt; 3 steps and will be removed
ℹ Run `dplyr::last_dplyr_warnings()` to see the 70 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>issa_bursts_winter <span class="ot">&lt;-</span> issa_track_nest <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"winter"</span>, <span class="st">"calving"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_resamp =</span> <span class="fu">map</span>(data, <span class="cf">function</span>(x)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">%&gt;%</span> <span class="fu">track_resample</span>(<span class="at">rate =</span> <span class="fu">hours</span>(<span class="dv">8</span>), <span class="at">tolerance =</span> <span class="fu">hours</span>(<span class="dv">1</span>))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">steps =</span> <span class="fu">map2</span>(data,data_resamp, <span class="cf">function</span>(x,y)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y<span class="sc">$</span>burst_))<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">%&gt;%</span> <span class="fu">steps</span>()</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> y <span class="sc">%&gt;%</span> <span class="fu">steps_by_burst</span>()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rand_steps =</span> <span class="fu">map</span>(steps, <span class="cf">function</span>(x){</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">%&gt;%</span> <span class="fu">random_steps</span>(<span class="at">n_control =</span> <span class="dv">10</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.49071435198262</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.64930971137248</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.56724394081064</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.68332538915642</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.62894092545827</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.59543328749614</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.5434871594889</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.62843390838056</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Steps with length 0 are present. This will lead to an error when fitting a gamma distribution. 0 step lengths are replaced with the smallest non zero step length, which is: 4.62677351093146</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 67 warnings in `mutate()`.
The first warning was:
ℹ In argument: `rand_steps = map(...)`.
Caused by warning in `random_steps.bursted_steps_xyt()`:
! Some bursts contain &lt; 3 steps and will be removed
ℹ Run `dplyr::last_dplyr_warnings()` to see the 66 remaining warnings.</code></pre>
</div>
</div>
<p>Next we assign covariate data to each step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>prcC_2020_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/prcC_2020_proj.tif"</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>mrtri3_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/mrtri3_proj.tif"</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>mrtpi_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/mrtpi_proj.tif"</span>))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mrtpi_proj) <span class="ot">&lt;-</span> <span class="st">"tpi"</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>mrdtm_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/mrdtm_proj.tif"</span>))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>water_dist <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/water_dist.tif"</span>))</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>lc_2010_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/lc_2010_proj.tif"</span>))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>lc_2010_maj <span class="ot">&lt;-</span> <span class="fu">focal</span>(lc_2010_proj, <span class="at">w =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">"modal"</span>, <span class="at">ties =</span> <span class="st">"first"</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>sm_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/sm_proj.nc"</span>))</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>nbr_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/ntems_fire_nbr_proj.tif"</span>))</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nbr_proj) <span class="ot">&lt;-</span> <span class="st">"nbr"</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>ridge_dist <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"data/processed/ridge_dist.tif"</span>))</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ridge_dist) <span class="ot">&lt;-</span> <span class="st">"ridge_dist"</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>weather_data_average <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data/processed/weather_data_average.rds"</span>))</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>rasts <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">"data/processed/fire_year"</span>), </span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">"*.tif$"</span>, </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>fire_year <span class="ot">&lt;-</span> <span class="fu">rast</span>(rasts)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>fire_year_maj <span class="ot">&lt;-</span> <span class="fu">focal</span>(fire_year, <span class="at">w =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">"modal"</span>, <span class="at">ties =</span> <span class="st">"first"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>rasts2 <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">"data/processed/fire_dist"</span>), </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">"*.tif$"</span>, </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>fire_dist <span class="ot">&lt;-</span> <span class="fu">rast</span>(rasts2)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>issa_data_summer <span class="ot">&lt;-</span> issa_bursts_summer <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_covs =</span> <span class="fu">map2</span>(rand_steps, id, <span class="cf">function</span>(x,y){</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>      x  <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cos_ta =</span> <span class="fu">cos</span>(ta_),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">log_sl =</span> <span class="fu">log</span>(sl_),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">id =</span> y,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">date =</span> <span class="fu">as.Date</span>(t1_)) <span class="sc">%&gt;%</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(weather_data_average) <span class="sc">%&gt;%</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(prcC_2020_proj, <span class="at">where =</span> <span class="st">"both"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrtri3_proj) <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrtpi_proj) <span class="sc">%&gt;%</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrdtm_proj, <span class="at">where =</span> <span class="st">"both"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(water_dist) <span class="sc">%&gt;%</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(lc_2010_maj) <span class="sc">%&gt;%</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(nbr_proj) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(ridge_dist) <span class="sc">%&gt;%</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates_var_time</span>(fire_year_maj, <span class="at">max_time =</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">when =</span> <span class="st">"before"</span>, <span class="at">name_covar =</span> <span class="st">"fire_year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates_var_time</span>(fire_dist, <span class="at">max_time =</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">when =</span> <span class="st">"before"</span>, <span class="at">name_covar =</span> <span class="st">"fire_dist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">drop_na</span>(ta_)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>issa_data_winter <span class="ot">&lt;-</span> issa_bursts_winter <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_covs =</span> <span class="fu">map2</span>(rand_steps, id, <span class="cf">function</span>(x,y){</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      x  <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cos_ta =</span> <span class="fu">cos</span>(ta_),</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">log_sl =</span> <span class="fu">log</span>(sl_),</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">id =</span> y,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">date =</span> <span class="fu">as.Date</span>(t1_)) <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(weather_data_average) <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(prcC_2020_proj, <span class="at">where =</span> <span class="st">"both"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrtri3_proj) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrtpi_proj) <span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(mrdtm_proj, <span class="at">where =</span> <span class="st">"both"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(water_dist) <span class="sc">%&gt;%</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(lc_2010_maj) <span class="sc">%&gt;%</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(nbr_proj) <span class="sc">%&gt;%</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates</span>(ridge_dist) <span class="sc">%&gt;%</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates_var_time</span>(fire_year_maj, <span class="at">max_time =</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">name_covar =</span> <span class="st">"fire_year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates_var_time</span>(sm_proj, <span class="at">max_time =</span> <span class="fu">days</span>(<span class="dv">2</span>),</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">name_covar =</span> <span class="st">"snow_depth"</span>,</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">where =</span> <span class="st">"start"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">extract_covariates_var_time</span>(fire_dist, <span class="at">max_time =</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">name_covar =</span> <span class="st">"fire_dist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">drop_na</span>(ta_)</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`
Joining with `by = join_by(date)`</code></pre>
</div>
</div>
<p>Next we will collapse each muskox-specific dataset into a combined dataset for each season. We will assign a new ID to each muskox burst and calculate some new covariates for the models. We will also examine the covariates for any correlation.<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>issa_data_summer_comb <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(issa_data_summer<span class="sc">$</span>data_covs) <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, step_id_) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">strat_id =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_water_dist =</span> <span class="fu">log</span>(layer<span class="sc">/</span><span class="dv">30</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_ridge_dist =</span> <span class="fu">log</span>(ridge_dist<span class="sc">/</span><span class="dv">30</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_fire_dist =</span> <span class="fu">log</span>(fire_dist<span class="sc">/</span><span class="dv">30</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">water =</span> <span class="fu">ifelse</span>(focal_modal <span class="sc">==</span> <span class="st">"Water"</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ridge =</span> <span class="fu">ifelse</span>(ridge_dist <span class="sc">==</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">nbr =</span> <span class="fu">replace_na</span>(nbr,<span class="dv">0</span>),</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">nbr_low =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nbr)<span class="sc">|</span>nbr<span class="sc">&lt;=</span><span class="dv">27</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">nbr_moderate =</span> <span class="fu">ifelse</span>(nbr<span class="sc">&gt;</span><span class="dv">27</span><span class="sc">&amp;</span>nbr<span class="sc">&lt;=</span><span class="dv">66</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">nbr_high =</span> <span class="fu">ifelse</span>(nbr<span class="sc">&gt;</span><span class="dv">66</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&lt;</span><span class="dv">100</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&lt;=</span><span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_20 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">10</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;=</span><span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_30 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">20</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;=</span><span class="dv">30</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_40 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">30</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;=</span><span class="dv">40</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_50 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">40</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;</span><span class="dv">100</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_low =</span> fire_10<span class="sc">*</span>nbr_low,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_mod =</span> fire_10<span class="sc">*</span>nbr_moderate,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_high =</span> fire_10<span class="sc">*</span>nbr_high,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_20_low =</span> fire_20<span class="sc">*</span>nbr_low,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_20_mod =</span> fire_20<span class="sc">*</span>nbr_moderate,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_20_high =</span> fire_20<span class="sc">*</span>nbr_high,         </span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">dummy_value =</span> <span class="dv">1</span>,</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>         <span class="do">### creating duplicate fire year vars for the fire distance </span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>         <span class="do">### interactions to make it easier to calculate RSS later</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_dup =</span> fire_10,</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_20_dup =</span> fire_20,</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_30_dup =</span> fire_30,</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_40_dup =</span> fire_40,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_50_dup =</span> fire_50,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">focal_modal =</span> <span class="fu">str_replace_all</span>(focal_modal, <span class="st">" "</span>, <span class="st">"_"</span>),</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">focal_modal =</span> <span class="fu">str_replace_all</span>(focal_modal, <span class="st">"-"</span>, <span class="st">"_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> focal_modal, <span class="at">values_from =</span> dummy_value, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wetland =</span> Water <span class="sc">+</span> Wetland,</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">Temperate_or_sub_polar_grassland =</span> Temperate_or_sub_polar_grassland <span class="sc">+</span> </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>           Sub_polar_or_polar_grassland_lichen_moss,</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">Temperate_or_sub_polar_needleleaf_forest =</span> Temperate_or_sub_polar_needleleaf_forest <span class="sc">+</span> </span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>           Mixed_forest)</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>issa_data_summer_comb <span class="sc">%&gt;%</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_sl, cos_ta, scanfi_prcC_end, mrdtm,tpi,</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>         fire_year, log_water_dist, log_ridge_dist,</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>         log_fire_dist) <span class="sc">%&gt;%</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      log_sl       cos_ta scanfi_prcC_end       mrdtm
log_sl           1.000000000  0.010402232      0.01836362 -0.01156320
cos_ta           0.010402232  1.000000000      0.00338730  0.02790132
scanfi_prcC_end  0.018363619  0.003387300      1.00000000  0.05082468
mrdtm           -0.011563204  0.027901318      0.05082468  1.00000000
tpi             -0.127699770 -0.020316689     -0.01617862  0.10826485
fire_year        0.095506571  0.021850583      0.36633753  0.15711560
log_water_dist  -0.072452569 -0.018764533      0.05069444  0.22144460
log_ridge_dist   0.046325931 -0.014390448     -0.16072482 -0.61365207
log_fire_dist    0.004832659  0.006928701      0.17099275  0.13449471
                        tpi   fire_year log_water_dist log_ridge_dist
log_sl          -0.12769977  0.09550657    -0.07245257     0.04632593
cos_ta          -0.02031669  0.02185058    -0.01876453    -0.01439045
scanfi_prcC_end -0.01617862  0.36633753     0.05069444    -0.16072482
mrdtm            0.10826485  0.15711560     0.22144460    -0.61365207
tpi              1.00000000  0.01372073     0.07739629    -0.35184614
fire_year        0.01372073  1.00000000    -0.03375549    -0.27678272
log_water_dist   0.07739629 -0.03375549     1.00000000    -0.18117848
log_ridge_dist  -0.35184614 -0.27678272    -0.18117848     1.00000000
log_fire_dist    0.05684967  0.44942918     0.01681504    -0.20657178
                log_fire_dist
log_sl            0.004832659
cos_ta            0.006928701
scanfi_prcC_end   0.170992747
mrdtm             0.134494706
tpi               0.056849675
fire_year         0.449429179
log_water_dist    0.016815039
log_ridge_dist   -0.206571784
log_fire_dist     1.000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>issa_data_summer_comb <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fire_year)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/combined_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>issa_data_winter_comb <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(issa_data_winter<span class="sc">$</span>data_covs) <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, step_id_) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">strat_id =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_water_dist =</span> <span class="fu">log</span>(layer<span class="sc">/</span><span class="dv">100</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_ridge_dist =</span> <span class="fu">log</span>(ridge_dist<span class="sc">/</span><span class="dv">30</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_fire_dist =</span> <span class="fu">log</span>(fire_dist<span class="sc">/</span><span class="dv">30</span><span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ridge =</span> <span class="fu">ifelse</span>(ridge_dist <span class="sc">==</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">water =</span> <span class="fu">ifelse</span>(focal_modal <span class="sc">==</span> <span class="st">"Water"</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>         <span class="do">### only 3-4 potentital steps in fires aged &lt;10 years</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>         <span class="do">### also not enough 1-20 year fires for separate groups based on nbr</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_20 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&lt;=</span><span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_10_20_30 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&lt;=</span><span class="dv">30</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_30 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">20</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;=</span><span class="dv">30</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">fire_40 =</span> <span class="fu">ifelse</span>(fire_year<span class="sc">&gt;</span><span class="dv">30</span><span class="sc">&amp;</span>fire_year<span class="sc">&lt;=</span><span class="dv">40</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">dtm_diff =</span> mrdtm_end <span class="sc">-</span> mrdtm_start,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">calving =</span> <span class="fu">ifelse</span>(<span class="fu">month</span>(t1_)<span class="sc">&gt;=</span><span class="dv">4</span><span class="sc">&amp;</span><span class="fu">month</span>(t1_)<span class="sc">&lt;=</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">dummy_value =</span> <span class="dv">1</span>,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">focal_modal =</span> <span class="fu">str_replace_all</span>(focal_modal, <span class="st">" "</span>, <span class="st">"_"</span>),</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">focal_modal =</span> <span class="fu">str_replace_all</span>(focal_modal, <span class="st">"-"</span>, <span class="st">"_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> focal_modal, <span class="at">values_from =</span> dummy_value, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wetland =</span> Water <span class="sc">+</span> Wetland,</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Temperate_or_sub_polar_grassland =</span> Temperate_or_sub_polar_grassland <span class="sc">+</span> </span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>           Sub_polar_or_polar_grassland_lichen_moss,</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">Temperate_or_sub_polar_needleleaf_forest =</span> Temperate_or_sub_polar_needleleaf_forest <span class="sc">+</span> </span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>           Mixed_forest)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>issa_data_winter_comb <span class="sc">%&gt;%</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_sl, cos_ta, mrdtm, </span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>         fire_year, log_fire_dist, snow_depth, avg_min_temp) <span class="sc">%&gt;%</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   log_sl       cos_ta        mrdtm   fire_year log_fire_dist
log_sl         1.00000000  0.018644156  0.075088958 -0.04795876  -0.029347194
cos_ta         0.01864416  1.000000000  0.022429325 -0.00995874  -0.003876701
mrdtm          0.07508896  0.022429325  1.000000000 -0.01172065   0.004806608
fire_year     -0.04795876 -0.009958740 -0.011720649  1.00000000   0.366310397
log_fire_dist -0.02934719 -0.003876701  0.004806608  0.36631040   1.000000000
snow_depth    -0.03505136 -0.013911567  0.127912463  0.07556861  -0.095003160
avg_min_temp   0.03185081  0.009001839  0.148699646 -0.01712291   0.008548702
               snow_depth avg_min_temp
log_sl        -0.03505136  0.031850814
cos_ta        -0.01391157  0.009001839
mrdtm          0.12791246  0.148699646
fire_year      0.07556861 -0.017122908
log_fire_dist -0.09500316  0.008548702
snow_depth     1.00000000 -0.270268152
avg_min_temp  -0.27026815  1.000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>issa_data_winter_comb <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fire_year)) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="step_selection_functions_files/figure-html/combined_data-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>issa_data_summer_comb <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(issa_data_winter_comb) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     burst_            x1_              x2_              y1_         
 Min.   :  1.00   Min.   :544518   Min.   :539736   Min.   :7232157  
 1st Qu.:  2.00   1st Qu.:585408   1st Qu.:585579   1st Qu.:7256981  
 Median :  6.00   Median :607324   Median :607388   Median :7263733  
 Mean   : 14.38   Mean   :607236   Mean   :607236   Mean   :7274808  
 3rd Qu.: 15.00   3rd Qu.:622810   3rd Qu.:622885   3rd Qu.:7282339  
 Max.   :123.00   Max.   :679826   Max.   :684753   Max.   :7354826  
 NA's   :1119                                                        
      y2_               sl_                ta_           
 Min.   :7231854   Min.   :    0.00   Min.   :-3.141593  
 1st Qu.:7257022   1st Qu.:   51.83   1st Qu.:-1.334308  
 Median :7263765   Median :  153.02   Median :-0.004118  
 Mean   :7274808   Mean   :  412.31   Mean   :-0.004730  
 3rd Qu.:7282348   3rd Qu.:  462.29   3rd Qu.: 1.324003  
 Max.   :7356572   Max.   :17921.56   Max.   : 3.141593  
                                                         
      t1_                           t2_                           dt_         
 Min.   :2007-12-04 08:00:00   Min.   :2007-12-04 16:00:00   Min.   :8 hours  
 1st Qu.:2009-03-23 08:00:00   1st Qu.:2009-03-23 16:00:00   1st Qu.:8 hours  
 Median :2009-11-14 08:00:00   Median :2009-11-14 16:00:00   Median :8 hours  
 Mean   :2009-11-26 11:40:19   Mean   :2009-11-26 19:40:19   Mean   :8 hours  
 3rd Qu.:2010-09-13 00:00:00   3rd Qu.:2010-09-13 08:00:00   3rd Qu.:8 hours  
 Max.   :2011-12-22 08:00:00   Max.   :2011-12-22 16:00:00   Max.   :8 hours  
                                                                              
   case_            step_id_          cos_ta            log_sl       
 Mode :logical   Min.   :   3.0   Min.   :-1.0000   Min.   :-10.703  
 FALSE:120920    1st Qu.: 210.0   1st Qu.:-0.5637   1st Qu.:  3.948  
 TRUE :11966     Median : 470.0   Median : 0.2393   Median :  5.031  
                 Mean   : 541.9   Mean   : 0.1217   Mean   :  4.948  
                 3rd Qu.: 826.0   3rd Qu.: 0.8093   3rd Qu.:  6.136  
                 Max.   :1539.0   Max.   : 1.0000   Max.   :  9.794  
                                                                     
       id             date            avg_mean_temp      avg_max_temp     
 7012   :29848   Min.   :2007-12-04   Min.   :-42.900   Min.   :-41.2000  
 7013   :28063   1st Qu.:2009-03-23   1st Qu.:-18.720   1st Qu.:-13.6000  
 7011   :27870   Median :2009-11-14   Median : -3.420   Median :  1.5400  
 7080   :14185   Mean   :2009-11-26   Mean   : -4.419   Mean   :  0.6918  
 706    :13631   3rd Qu.:2010-09-13   3rd Qu.: 10.800   3rd Qu.: 16.1800  
 708    :10686   Max.   :2011-12-22   Max.   : 22.029   Max.   : 29.6000  
 (Other): 8603                                                            
  avg_min_temp      avg_precip         avg_wind     num_stations_temp
 Min.   :-46.36   Min.   : 0.0000   Min.   :31.00   Min.   :2.000    
 1st Qu.:-23.05   1st Qu.: 0.0000   1st Qu.:31.00   1st Qu.:5.000    
 Median : -6.78   Median : 0.2000   Median :32.00   Median :5.000    
 Mean   : -9.53   Mean   : 0.8595   Mean   :34.43   Mean   :5.677    
 3rd Qu.:  5.22   3rd Qu.: 0.8500   3rd Qu.:35.60   3rd Qu.:7.000    
 Max.   : 15.65   Max.   :23.4750   Max.   :90.60   Max.   :8.000    
                                                                     
 num_stations_precip num_stations_wind scanfi_prcC_start scanfi_prcC_end   
 Min.   :1.000       Min.   :2.000     Min.   :  0.000   Min.   :  0.0000  
 1st Qu.:3.000       1st Qu.:4.000     1st Qu.:  0.605   1st Qu.:  0.7653  
 Median :4.000       Median :5.000     Median :  4.977   Median :  5.3389  
 Mean   :4.347       Mean   :4.679     Mean   :  8.068   Mean   :  8.3873  
 3rd Qu.:5.000       3rd Qu.:5.000     3rd Qu.: 12.451   3rd Qu.: 12.6948  
 Max.   :7.000       Max.   :5.000     Max.   :100.000   Max.   :100.0000  
                                                                           
     mrdtm              tpi           mrdtm_start      mrdtm_end     
 Min.   :  0.000   Min.   :-91.078   Min.   :106.6   Min.   : 91.41  
 1st Qu.:  2.488   1st Qu.: -2.420   1st Qu.:286.1   1st Qu.:279.81  
 Median :  5.404   Median :  1.657   Median :416.2   Median :401.12  
 Mean   :  7.949   Mean   :  3.606   Mean   :425.3   Mean   :417.76  
 3rd Qu.: 10.444   3rd Qu.:  9.085   3rd Qu.:527.8   3rd Qu.:524.34  
 Max.   :119.523   Max.   :114.232   Max.   :955.8   Max.   :955.82  
                                                                     
     layer             nbr           ridge_dist        fire_year     
 Min.   :   0.0   Min.   :  0.00   Min.   :    0.0   Min.   :  2.00  
 1st Qu.: 379.5   1st Qu.:  0.00   1st Qu.:  406.8   1st Qu.:100.00  
 Median : 721.2   Median :  0.00   Median : 1236.1   Median :100.00  
 Mean   : 858.8   Mean   : 34.59   Mean   : 3798.0   Mean   : 81.82  
 3rd Qu.:1195.5   3rd Qu.: 70.85   3rd Qu.: 3776.4   3rd Qu.:100.00  
 Max.   :4205.6   Max.   :126.62   Max.   :31946.2   Max.   :100.00  
                  NA's   :66582                                      
   fire_dist         strat_id    log_water_dist  log_ridge_dist 
 Min.   :   0.0   Min.   :   1   Min.   :0.000   Min.   :0.000  
 1st Qu.: 840.5   1st Qu.:1511   1st Qu.:1.791   1st Qu.:2.678  
 Median :2446.2   Median :3022   Median :2.484   Median :3.743  
 Mean   :2983.0   Mean   :3105   Mean   :2.482   Mean   :3.725  
 3rd Qu.:4897.3   3rd Qu.:4534   3rd Qu.:3.239   3rd Qu.:4.843  
 Max.   :9537.0   Max.   :7044   Max.   :4.950   Max.   :6.972  
                                                                
 log_fire_dist       water              ridge            nbr_low     
 Min.   :0.000   Min.   :0.000000   Min.   :0.00000   Min.   :0.000  
 1st Qu.:3.368   1st Qu.:0.000000   1st Qu.:0.00000   1st Qu.:0.000  
 Median :4.413   Median :0.000000   Median :0.00000   Median :1.000  
 Mean   :4.061   Mean   :0.009753   Mean   :0.04234   Mean   :0.638  
 3rd Qu.:5.101   3rd Qu.:0.000000   3rd Qu.:0.00000   3rd Qu.:1.000  
 Max.   :5.765   Max.   :1.000000   Max.   :1.00000   Max.   :1.000  
                                                      NA's   :77369  
  nbr_moderate      nbr_high          fire          fire_10     
 Min.   :0.00    Min.   :0.000   Min.   :0.000   Min.   :0.000  
 1st Qu.:0.00    1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.000  
 Median :0.00    Median :0.000   Median :0.000   Median :0.000  
 Mean   :0.16    Mean   :0.202   Mean   :0.414   Mean   :0.253  
 3rd Qu.:0.00    3rd Qu.:0.000   3rd Qu.:1.000   3rd Qu.:1.000  
 Max.   :1.00    Max.   :1.000   Max.   :1.000   Max.   :1.000  
 NA's   :77369   NA's   :77369   NA's   :77369   NA's   :77369  
    fire_20         fire_30           fire_40           fire_50     
 Min.   :0.000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000  
 1st Qu.:0.000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000  
 Median :0.000   Median :0.00000   Median :0.00000   Median :0.000  
 Mean   :0.087   Mean   :0.01055   Mean   :0.04475   Mean   :0.017  
 3rd Qu.:0.000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000  
 Max.   :1.000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000  
 NA's   :77369                                       NA's   :77369  
  fire_10_low     fire_10_mod     fire_10_high    fire_20_low   
 Min.   :0.00    Min.   :0.000   Min.   :0.000   Min.   :0.000  
 1st Qu.:0.00    1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.000  
 Median :0.00    Median :0.000   Median :0.000   Median :0.000  
 Mean   :0.01    Mean   :0.079   Mean   :0.163   Mean   :0.013  
 3rd Qu.:0.00    3rd Qu.:0.000   3rd Qu.:0.000   3rd Qu.:0.000  
 Max.   :1.00    Max.   :1.000   Max.   :1.000   Max.   :1.000  
 NA's   :77369   NA's   :77369   NA's   :77369   NA's   :77369  
  fire_20_mod     fire_20_high    fire_10_dup     fire_20_dup   
 Min.   :0.000   Min.   :0.000   Min.   :0.000   Min.   :0.000  
 1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.000  
 Median :0.000   Median :0.000   Median :0.000   Median :0.000  
 Mean   :0.052   Mean   :0.022   Mean   :0.253   Mean   :0.087  
 3rd Qu.:0.000   3rd Qu.:0.000   3rd Qu.:1.000   3rd Qu.:0.000  
 Max.   :1.000   Max.   :1.000   Max.   :1.000   Max.   :1.000  
 NA's   :77369   NA's   :77369   NA's   :77369   NA's   :77369  
  fire_30_dup     fire_40_dup     fire_50_dup   
 Min.   :0.000   Min.   :0.000   Min.   :0.000  
 1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.000  
 Median :0.000   Median :0.000   Median :0.000  
 Mean   :0.021   Mean   :0.035   Mean   :0.017  
 3rd Qu.:0.000   3rd Qu.:0.000   3rd Qu.:0.000  
 Max.   :1.000   Max.   :1.000   Max.   :1.000  
 NA's   :77369   NA's   :77369   NA's   :77369  
 Sub_polar_taiga_needleleaf_forest    Wetland       
 Min.   :0.0000                    Min.   :0.00000  
 1st Qu.:0.0000                    1st Qu.:0.00000  
 Median :0.0000                    Median :0.00000  
 Mean   :0.3703                    Mean   :0.01847  
 3rd Qu.:1.0000                    3rd Qu.:0.00000  
 Max.   :1.0000                    Max.   :1.00000  
                                                    
 Temperate_or_sub_polar_needleleaf_forest Temperate_or_sub_polar_grassland
 Min.   :0.0000                           Min.   :0.00000                 
 1st Qu.:0.0000                           1st Qu.:0.00000                 
 Median :0.0000                           Median :0.00000                 
 Mean   :0.4539                           Mean   :0.09124                 
 3rd Qu.:1.0000                           3rd Qu.:0.00000                 
 Max.   :1.0000                           Max.   :1.00000                 
                                                                          
     Water          Temperate_or_sub_polar_shrubland  Barren_Lands    
 Min.   :0.000000   Min.   :0.00000                  Min.   :0.00000  
 1st Qu.:0.000000   1st Qu.:0.00000                  1st Qu.:0.00000  
 Median :0.000000   Median :0.00000                  Median :0.00000  
 Mean   :0.009753   Mean   :0.04878                  Mean   :0.01728  
 3rd Qu.:0.000000   3rd Qu.:0.00000                  3rd Qu.:0.00000  
 Max.   :1.000000   Max.   :1.00000                  Max.   :1.00000  
                                                                      
  Mixed_forest      Sub_polar_or_polar_grassland_lichen_moss   snow_depth   
 Min.   :0.000000   Min.   :0.000000                         Min.   :0.000  
 1st Qu.:0.000000   1st Qu.:0.000000                         1st Qu.:0.113  
 Median :0.000000   Median :0.000000                         Median :0.182  
 Mean   :0.003492   Mean   :0.001422                         Mean   :0.180  
 3rd Qu.:0.000000   3rd Qu.:0.000000                         3rd Qu.:0.239  
 Max.   :1.000000   Max.   :1.000000                         Max.   :0.692  
                                                             NA's   :55517  
   fire_10_20    fire_10_20_30      dtm_diff           calving     
 Min.   :0.00    Min.   :0.000   Min.   :-251.115   Min.   :0.000  
 1st Qu.:0.00    1st Qu.:0.000   1st Qu.:  -3.028   1st Qu.:0.000  
 Median :0.00    Median :0.000   Median :   0.000   Median :0.000  
 Mean   :0.02    Mean   :0.023   Mean   :  -1.837   Mean   :0.228  
 3rd Qu.:0.00    3rd Qu.:0.000   3rd Qu.:   1.428   3rd Qu.:0.000  
 Max.   :1.00    Max.   :1.000   Max.   : 187.205   Max.   :1.000  
 NA's   :55517   NA's   :55517   NA's   :55517      NA's   :55517  </code></pre>
</div>
</div>
<p>Lastly, we will fit models for the summer and winter datasets separately. Models are fit using the ISSA method that allows for random effects. This way we can automatically pool estimates across individuals to come up with a population-level estimate for each covariate. We’ll run a fire and landcover model for each season.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>m0_summer_glmmfit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(case_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">*</span><span class="fu">scale</span>(cos_ta) <span class="sc">+</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># scale(scanfi_prcC_end) +</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(mrdtm) <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_water_dist) <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist) <span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_10_dup <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_20_dup <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_30_dup <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_40_dup <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(tpi) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                               water <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># Wetland + </span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>                               fire_10_low <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>                               fire_10_mod <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>                               fire_10_high <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>                               fire_20_low <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>                               fire_20_mod <span class="sc">+</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>                               fire_20_high <span class="sc">+</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>                               fire_30 <span class="sc">+</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>                               fire_40 <span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># fire_50 +</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(avg_max_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">1</span><span class="sc">|</span>strat_id) <span class="sc">+</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">:</span><span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(tpi)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_water_dist)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_10_dup<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_20_dup<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_30_dup<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">:</span>fire_40_dup<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> water<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + Wetland|id) +</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(mrdtm)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_10_low<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_10_mod<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_10_high<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_20_low<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_20_mod<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_20_high<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_30<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_40<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + fire_50|id) +</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(avg_max_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id), </span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> poisson,</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> issa_data_summer_comb,</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>                             <span class="at">map=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>))),</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>                             <span class="at">start=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">c</span>(<span class="fu">log</span>(<span class="fl">1e3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">21</span>))))</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_summer_glmmfit)</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(issa_data_summer_comb, <span class="fu">here</span>(<span class="st">"data/processed/issa_data_summer_comb.rds"</span>))</span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a><span class="co"># issa_data_summer_comb &lt;- readRDS("data/processed/issa_data_summer_comb.rds")</span></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m0_summer_glmmfit, <span class="fu">here</span>(<span class="st">"output/m0_summer_glmmfit.rds"</span>))</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>m0_summer_glmmfit_lc <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(case_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">*</span><span class="fu">scale</span>(cos_ta) <span class="sc">+</span> </span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># scale(scanfi_prcC_end) +</span></span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(mrdtm) <span class="sc">+</span></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(tpi) <span class="sc">+</span></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a>                               Sub_polar_taiga_needleleaf_forest <span class="sc">+</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a>                               Temperate_or_sub_polar_shrubland <span class="sc">+</span></span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a>                               Temperate_or_sub_polar_grassland <span class="sc">+</span></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a>                               Wetland <span class="sc">+</span></span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a>                               Barren_Lands <span class="sc">+</span></span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(avg_max_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">1</span><span class="sc">|</span>strat_id) <span class="sc">+</span></span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">:</span><span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + scale(scanfi_prcC_end)|id) +</span></span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(tpi)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_water_dist)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> water<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(mrdtm)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Sub_polar_taiga_needleleaf_forest<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Temperate_or_sub_polar_shrubland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Temperate_or_sub_polar_grassland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Mixed_forest<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Wetland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> Barren_Lands<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(avg_max_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id), </span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> poisson,</span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> issa_data_summer_comb,</span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a>                             <span class="at">map=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))),</span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a>                             <span class="at">start=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">c</span>(<span class="fu">log</span>(<span class="fl">1e3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">14</span>))))</span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_summer_glmmfit_lc)</span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m0_summer_glmmfit_lc, <span class="fu">here</span>(<span class="st">"output/m0_summer_glmmfit_lc.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>m0_summer_glmmfit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"output/m0_summer_glmmfit.rds"</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_summer_glmmfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson  ( log )
Formula:          
case_ ~ -1 + scale(log_sl) * scale(cos_ta) + scale(mrdtm) + scale(log_water_dist) +  
    scale(log_fire_dist) + scale(log_fire_dist):fire_10_dup +  
    scale(log_fire_dist):fire_20_dup + scale(log_fire_dist):fire_30_dup +  
    scale(log_fire_dist):fire_40_dup + scale(tpi) + water + fire_10_low +  
    fire_10_mod + fire_10_high + fire_20_low + fire_20_mod +  
    fire_20_high + fire_30 + fire_40 + scale(avg_max_temp):scale(log_sl) +  
    (1 | strat_id) + (0 + scale(log_sl) | id) + (0 + scale(cos_ta) |  
    id) + (0 + scale(log_sl):scale(cos_ta) | id) + (0 + scale(tpi) |  
    id) + (0 + scale(log_water_dist) | id) + (0 + scale(log_fire_dist) |  
    id) + (0 + scale(log_fire_dist):fire_10_dup | id) + (0 +  
    scale(log_fire_dist):fire_20_dup | id) + (0 + scale(log_fire_dist):fire_30_dup |  
    id) + (0 + scale(log_fire_dist):fire_40_dup | id) + (0 +  
    water | id) + (0 + scale(mrdtm) | id) + (0 + fire_10_low |  
    id) + (0 + fire_10_mod | id) + (0 + fire_10_high | id) +  
    (0 + fire_20_low | id) + (0 + fire_20_mod | id) + (0 + fire_20_high |  
    id) + (0 + fire_30 | id) + (0 + fire_40 | id) + (0 + scale(avg_max_temp):scale(log_sl) |  
    id)
Data: issa_data_summer_comb

      AIC       BIC    logLik -2*log(L)  df.resid 
 102323.5  102698.3  -51119.8  102239.5     55475 

Random effects:

Conditional model:
 Groups   Name                              Variance  Std.Dev. 
 strat_id (Intercept)                       1.000e+06 1.000e+03
 id       scale(log_sl)                     1.559e-10 1.248e-05
 id.1     scale(cos_ta)                     9.941e-11 9.971e-06
 id.2     scale(log_sl):scale(cos_ta)       6.472e-09 8.045e-05
 id.3     scale(tpi)                        3.809e-02 1.952e-01
 id.4     scale(log_water_dist)             1.182e-02 1.087e-01
 id.5     scale(log_fire_dist)              9.316e-10 3.052e-05
 id.6     scale(log_fire_dist):fire_10_dup  2.090e-07 4.572e-04
 id.7     scale(log_fire_dist):fire_20_dup  1.142e-09 3.380e-05
 id.8     scale(log_fire_dist):fire_30_dup  9.532e-02 3.087e-01
 id.9     scale(log_fire_dist):fire_40_dup  6.031e-10 2.456e-05
 id.10    water                             1.225e-08 1.107e-04
 id.11    scale(mrdtm)                      1.976e-08 1.406e-04
 id.12    fire_10_low                       1.187e-08 1.090e-04
 id.13    fire_10_mod                       1.922e-01 4.384e-01
 id.14    fire_10_high                      4.255e-02 2.063e-01
 id.15    fire_20_low                       1.062e-09 3.259e-05
 id.16    fire_20_mod                       1.053e-09 3.245e-05
 id.17    fire_20_high                      2.838e-11 5.328e-06
 id.18    fire_30                           8.320e-09 9.122e-05
 id.19    fire_40                           8.406e-10 2.899e-05
 id.20    scale(avg_max_temp):scale(log_sl) 1.182e-03 3.438e-02
Number of obs: 55517, groups:  strat_id, 5048; id, 7

Conditional model:
                                  Estimate Std. Error z value Pr(&gt;|z|)    
scale(log_sl)                      0.14099    0.01625   8.676  &lt; 2e-16 ***
scale(cos_ta)                      0.03051    0.01526   1.999  0.04564 *  
scale(mrdtm)                      -0.13908    0.02215  -6.278 3.44e-10 ***
scale(log_water_dist)              0.05189    0.04946   1.049  0.29409    
scale(log_fire_dist)              -0.02046    0.05201  -0.393  0.69407    
scale(tpi)                         0.54670    0.08916   6.132 8.69e-10 ***
water                             -2.00582    0.34781  -5.767 8.07e-09 ***
fire_10_low                        0.30192    0.21085   1.432  0.15215    
fire_10_mod                        0.95369    0.25158   3.791  0.00015 ***
fire_10_high                       1.33756    0.15071   8.875  &lt; 2e-16 ***
fire_20_low                        0.64485    0.23832   2.706  0.00681 ** 
fire_20_mod                        0.84183    0.19283   4.366 1.27e-05 ***
fire_20_high                       1.40669    0.20542   6.848 7.50e-12 ***
fire_30                            0.16428    0.25279   0.650  0.51579    
fire_40                           -0.50406    0.18994  -2.654  0.00796 ** 
scale(log_sl):scale(cos_ta)        0.12974    0.01511   8.589  &lt; 2e-16 ***
scale(log_fire_dist):fire_10_dup  -0.21514    0.07447  -2.889  0.00386 ** 
scale(log_fire_dist):fire_20_dup  -0.30830    0.10860  -2.839  0.00453 ** 
scale(log_fire_dist):fire_30_dup   0.21010    0.29069   0.723  0.46982    
scale(log_fire_dist):fire_40_dup  -0.04996    0.17760  -0.281  0.77846    
scale(log_sl):scale(avg_max_temp)  0.18755    0.02141   8.761  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m0_summer_glmmfit_lc &lt;- readRDS(here("output/m0_summer_glmmfit_lc.rds"))</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0_summer_glmmfit_lc)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>m0_winter_glmmfit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(case_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">*</span><span class="fu">scale</span>(cos_ta) <span class="sc">+</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(mrdtm) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(tpi) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># scale(log_water_dist) +</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># water +</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                               fire_10_20_30 <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                               fire_40 <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(log_fire_dist) <span class="sc">+</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># fire_10_20_30:scale(log_fire_dist) +</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># fire_40:scale(log_fire_dist) +</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                               calving<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(snow_depth)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">scale</span>(avg_min_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">1</span><span class="sc">|</span>strat_id) <span class="sc">+</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">:</span><span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + water|id) +</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(tpi)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(mrdtm)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_fire_dist)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + scale(log_water_dist)|id) +</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(snow_depth)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(avg_min_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_10_20_30<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> fire_40<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + fire_10_20_30:scale(log_fire_dist)|id) +</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># (0 + fire_40:scale(log_fire_dist)|id) +</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>                               (<span class="dv">0</span> <span class="sc">+</span> calving<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id), </span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> poisson,</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> issa_data_winter_comb,</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">map=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>))),</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>                             <span class="at">start=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">c</span>(<span class="fu">log</span>(<span class="fl">1e3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">11</span>))))</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_winter_glmmfit)</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(issa_data_winter_comb, <span class="fu">here</span>(<span class="st">"data/processed/issa_data_winter_comb.rds"</span>))</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m0_winter_glmmfit, <span class="fu">here</span>(<span class="st">"output/m0_winter_glmmfit.rds"</span>))</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>m0_winter_glmmfit_lc <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(case_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">*</span><span class="fu">scale</span>(cos_ta) <span class="sc">+</span> </span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">scale</span>(mrdtm) <span class="sc">+</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">scale</span>(tpi) <span class="sc">+</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># scale(log_water_dist) +</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># water +</span></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>                                  Wetland <span class="sc">+</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>                                  Sub_polar_taiga_needleleaf_forest <span class="sc">+</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>                                  Temperate_or_sub_polar_shrubland <span class="sc">+</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>                                  Temperate_or_sub_polar_grassland <span class="sc">+</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># Mixed_forest +</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>                                  Barren_Lands <span class="sc">+</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>                                  calving<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">scale</span>(snow_depth)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">scale</span>(avg_min_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl) <span class="sc">+</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">1</span><span class="sc">|</span>strat_id) <span class="sc">+</span></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(log_sl)<span class="sc">:</span><span class="fu">scale</span>(cos_ta)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>                                  </span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> Wetland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(tpi)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(mrdtm)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># (0 + water|id) +</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># (0 + scale(log_water_dist)|id)  +</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> Sub_polar_taiga_needleleaf_forest<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> Temperate_or_sub_polar_shrubland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> Temperate_or_sub_polar_grassland<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># (0 + Mixed_forest|id) +</span></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> Barren_Lands<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> calving<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(avg_min_temp)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) <span class="sc">+</span></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(snow_depth)<span class="sc">:</span><span class="fu">scale</span>(log_sl)<span class="sc">|</span>id) , </span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>                                <span class="at">family =</span> poisson,</span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> issa_data_winter_comb,</span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a>                                <span class="at">map=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>))),</span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a>                                <span class="at">start=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">c</span>(<span class="fu">log</span>(<span class="fl">1e3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">13</span>))))</span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_winter_glmmfit_lc)</span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m0_winter_glmmfit_lc, <span class="st">"output/m0_winter_glmmfit_lc.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>m0_winter_glmmfit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"output/m0_winter_glmmfit.rds"</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_winter_glmmfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson  ( log )
Formula:          
case_ ~ -1 + scale(log_sl) * scale(cos_ta) + scale(mrdtm) + scale(tpi) +  
    fire_10_20_30 + fire_40 + scale(log_fire_dist) + calving:scale(log_sl) +  
    scale(snow_depth):scale(log_sl) + scale(avg_min_temp):scale(log_sl) +  
    (1 | strat_id) + (0 + scale(log_sl) | id) + (0 + scale(cos_ta) |  
    id) + (0 + scale(log_sl):scale(cos_ta) | id) + (0 + scale(tpi) |  
    id) + (0 + scale(mrdtm) | id) + (0 + scale(log_fire_dist) |  
    id) + (0 + scale(snow_depth):scale(log_sl) | id) + (0 + scale(avg_min_temp):scale(log_sl) |  
    id) + (0 + fire_10_20_30 | id) + (0 + fire_40 | id) + (0 +  
    calving:scale(log_sl) | id)
Data: issa_data_winter_comb

      AIC       BIC    logLik -2*log(L)  df.resid 
 141701.1  141904.8  -70828.6  141657.1     77347 

Random effects:

Conditional model:
 Groups   Name                              Variance  Std.Dev. 
 strat_id (Intercept)                       1.000e+06 1.000e+03
 id       scale(log_sl)                     1.877e-02 1.370e-01
 id.1     scale(cos_ta)                     6.103e-04 2.470e-02
 id.2     scale(log_sl):scale(cos_ta)       4.524e-04 2.127e-02
 id.3     scale(tpi)                        6.998e-01 8.365e-01
 id.4     scale(mrdtm)                      1.132e-07 3.364e-04
 id.5     scale(log_fire_dist)              4.563e-02 2.136e-01
 id.6     scale(snow_depth):scale(log_sl)   6.685e-02 2.585e-01
 id.7     scale(avg_min_temp):scale(log_sl) 2.370e-04 1.539e-02
 id.8     fire_10_20_30                     7.379e-02 2.716e-01
 id.9     fire_40                           2.801e-07 5.292e-04
 id.10    calving:scale(log_sl)             1.582e-02 1.258e-01
Number of obs: 77369, groups:  strat_id, 7044; id, 9

Conditional model:
                                  Estimate Std. Error z value Pr(&gt;|z|)    
scale(log_sl)                      0.15480    0.05325   2.907 0.003651 ** 
scale(cos_ta)                     -0.01207    0.01640  -0.736 0.461692    
scale(mrdtm)                      -0.20631    0.02434  -8.475  &lt; 2e-16 ***
scale(tpi)                         0.60801    0.29451   2.065 0.038970 *  
fire_10_20_30                     -0.86434    0.27731  -3.117 0.001828 ** 
fire_40                           -0.09253    0.18930  -0.489 0.624980    
scale(log_fire_dist)              -0.04208    0.13567  -0.310 0.756471    
scale(log_sl):scale(cos_ta)        0.10995    0.01626   6.764 1.35e-11 ***
scale(log_sl):calving             -0.32886    0.06927  -4.747 2.06e-06 ***
scale(log_sl):scale(snow_depth)   -0.34542    0.09310  -3.710 0.000207 ***
scale(log_sl):scale(avg_min_temp)  0.20388    0.02489   8.191 2.58e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>m0_winter_glmmfit_lc <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"output/m0_winter_glmmfit_lc.rds"</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0_winter_glmmfit_lc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson  ( log )
Formula:          
case_ ~ -1 + scale(log_sl) * scale(cos_ta) + scale(mrdtm) + scale(tpi) +  
    Wetland + Sub_polar_taiga_needleleaf_forest + Temperate_or_sub_polar_shrubland +  
    Temperate_or_sub_polar_grassland + calving:scale(log_sl) +  
    scale(snow_depth):scale(log_sl) + scale(avg_min_temp):scale(log_sl) +  
    (1 | strat_id) + (0 + scale(log_sl) | id) + (0 + scale(cos_ta) |  
    id) + (0 + scale(log_sl):scale(cos_ta) | id) + (0 + Wetland |  
    id) + (0 + scale(tpi) | id) + (0 + scale(mrdtm) | id) + (0 +  
    Sub_polar_taiga_needleleaf_forest | id) + (0 + Temperate_or_sub_polar_shrubland |  
    id) + (0 + Temperate_or_sub_polar_grassland | id) + (0 +  
    calving:scale(log_sl) | id) + (0 + scale(avg_min_temp):scale(log_sl) |  
    id) + (0 + scale(snow_depth):scale(log_sl) | id)
Data: issa_data_winter_comb

      AIC       BIC    logLik -2*log(L)  df.resid 
 141674.3  141896.5  -70813.2  141626.3     77345 

Random effects:

Conditional model:
 Groups   Name                              Variance  Std.Dev. 
 strat_id (Intercept)                       1.000e+06 1.000e+03
 id       scale(log_sl)                     1.802e-02 1.342e-01
 id.1     scale(cos_ta)                     6.504e-04 2.550e-02
 id.2     scale(log_sl):scale(cos_ta)       4.543e-04 2.131e-02
 id.3     Wetland                           2.143e-07 4.630e-04
 id.4     scale(tpi)                        6.280e-01 7.925e-01
 id.5     scale(mrdtm)                      1.219e-03 3.491e-02
 id.6     Sub_polar_taiga_needleleaf_forest 7.978e-02 2.825e-01
 id.7     Temperate_or_sub_polar_shrubland  1.896e-07 4.355e-04
 id.8     Temperate_or_sub_polar_grassland  1.200e-01 3.464e-01
 id.9     calving:scale(log_sl)             1.674e-02 1.294e-01
 id.10    scale(avg_min_temp):scale(log_sl) 2.533e-07 5.033e-04
 id.11    scale(snow_depth):scale(log_sl)   6.580e-02 2.565e-01
Number of obs: 77369, groups:  strat_id, 7044; id, 9

Conditional model:
                                  Estimate Std. Error z value Pr(&gt;|z|)    
scale(log_sl)                      0.16176    0.05215   3.102 0.001923 ** 
scale(cos_ta)                     -0.01104    0.01655  -0.667 0.504782    
scale(mrdtm)                      -0.20909    0.03023  -6.917 4.62e-12 ***
scale(tpi)                         0.59138    0.28058   2.108 0.035054 *  
Wetland                           -0.03242    0.13569  -0.239 0.811145    
Sub_polar_taiga_needleleaf_forest  0.00861    0.10888   0.079 0.936973    
Temperate_or_sub_polar_shrubland  -0.60502    0.17239  -3.510 0.000449 ***
Temperate_or_sub_polar_grassland  -0.13360    0.31666  -0.422 0.673086    
scale(log_sl):scale(cos_ta)        0.11053    0.01627   6.795 1.08e-11 ***
scale(log_sl):calving             -0.33460    0.06919  -4.836 1.33e-06 ***
scale(log_sl):scale(snow_depth)   -0.34724    0.09234  -3.760 0.000170 ***
scale(log_sl):scale(avg_min_temp)  0.20699    0.02036  10.168  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>